---
import Layout from '../layouts/Layout.astro';
import UtilHeader from '../components/UtilHeader.astro';
import UtilTile from '../components/UtilTile.astro';
import SectionPagination from '../components/SectionPagination.astro';
import TileOrder from '../components/TileOrder.astro';

import type {IUser, ITileOrder, IPayment} from '../interfaces';

import data from '../pages/profile.json';

const {tel, firstName, middleName, lastName, email, amount, balance}: IUser = data.user;
const payments: IPayment[] = data.payments;
const orders: ITileOrder[] = data.orders;
const lastPage: number = data.lastPage;
const currentPage: number = 1;

const title: string = 'Личный кабинет';
const link: string = '/profile';
---

<Layout title="Профиль" page="profile" isUser={true} userInfo={data.user}>
  <link rel="stylesheet" href="./pages/profile.css"/>
  <div class="page-wrapper">
    <UtilHeader type="profile" title={title}/>

    {1 === currentPage && (
      <UtilTile tag="section" classList={['section']}>
        <div class="info">
          <span class="primary title">{tel}</span>
        </div>
        <button type="button" class="button" data-popup-open="profile-tel">
          <span>Изменить</span>
        </button>
      </UtilTile>

      <UtilTile tag="section" classList={['section']}>
        <div class="info">
          <span class="primary title">{lastName} {firstName} {middleName}</span>
          <span class="primary text">{email}</span>
        </div>
        <button type="button" class="button" data-popup-open="profile-name">
          <span>Изменить</span>
        </button>
      </UtilTile>

      <UtilTile tag="section" classList={['section']}>
        <div class="info">
          <span class="primary title">{amount.toLocaleString('ru-RU')} руб.</span>
          <span class="third text">Общая сумма заказов</span>
        </div>
        <div class="info">
          <span class="secondary title">{balance.toLocaleString('ru-RU')} руб.</span>
          <span class="secondary text">Бонусов на счету</span>
        </div>
      </UtilTile>
    )}

    <UtilTile tag="section" classList={['section-orders']}>
      <div class="orders-title">История заказов</div>
      <div class="orders" data-page-items>
        {orders.map((order: ITileOrder) => (
          <TileOrder order={order} payments={payments}/>
        ))}
      </div>
    </UtilTile>

    {1 < lastPage &&
      <SectionPagination currentPage={currentPage} lastPage={lastPage} baseLink={link}/>}
  </div>

  {0 < orders.length && (
    <div slot="page-footer" class="payments-backdrop" data-payments-backdrop hidden>
      <div class="payments" data-payments data-order-id="">
        <div class="payments-header">
          <span class="text">Изменить способ оплаты</span>
          <button type="button" class="close" data-payments-close>
            <svg width="14" height="13" viewBox="0 0 14 13" xmlns="http://www.w3.org/2000/svg">
              <path d="M0.999999 1L7 6.5L1 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round"/>
              <path d="M13 12L7 6.5L13 1" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
        <div class="payments-main">
          {payments.map((payment: IPayment) => (
            <button type="button" class="payment" data-payment-id-new={payment.id}>
              <span class="text">{payment.name}</span>
              <img src={payment.img} alt="" class="img" decoding="async" loading="lazy"/>
            </button>
          ))}
        </div>
      </div>
    </div>
  )}
  <script src="./pages/profile.js" is:inline async></script>
</Layout>
