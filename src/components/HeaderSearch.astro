---
import type {ISearchResult} from '../interfaces';

import data from '../components/HeaderSearch.json';

const results: ISearchResult[] = data.results;

const ldJson: {} = {
  '@context': '//schema.org',
  '@type': 'WebSite',
  'url': 'https://m.airsoft-rus.ru',
  'potentialAction': {
    '@type': 'SearchAction',
    'target': {
      '@type': 'EntryPoint',
      'urlTemplate': 'https://m.airsoft-rus.ru/catalog/?q={search_term_string}',
    },
    'query-input': 'required name=search_term_string',
  },
};
---

<form class="header-search" role="search" action="/search" novalidate data-form-search>
  <Fragment set:html={`<script type="application/ld+json">${JSON.stringify(ldJson)}</script>`}/>
  <input type="search" name="search" id="search" class="input" maxlength="256"
         placeholder="Поиск по каталогу" aria-label="Поиск по каталогу"/>
  <button type="submit" class="button" title="Найти">
    <svg width="18" height="18" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
      <path stroke="#009AE3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            d="M13.0215 13.0801L19.0215 19.0801M8.02148 15.0801C4.15549 15.0801 1.02148 11.9461 1.02148 8.08008C1.02148 4.21409 4.15549 1.08008 8.02148 1.08008C11.8875 1.08008 15.0215 4.21409 15.0215 8.08008C15.0215 11.9461 11.8875 15.0801 8.02148 15.0801Z"/>
    </svg>
  </button>
</form>
<div class="header-search-popup" hidden>
  <div class="header-search-results-wrapper">
    <div class="header-search-results" hidden>
      {results.map(({img, link, name, oldPrice, price}: ISearchResult) => (
        <a href={link} class="result">
          <img src={img} alt={name} class="img" decoding="async" loading="lazy"/>
          <div>
            <div>
              <span class="title">{name}</span>
            </div>
            <div>
              <span class="text">Цена</span>
              {oldPrice === price ? (
                <span class="price">{price.toLocaleString('ru-RU')} р.</span>
              ) : (
                <span class="price-old">{oldPrice.toLocaleString('ru-RU')} р.</span>
                <span class="price-new">{price.toLocaleString('ru-RU')} р.</span>
              )}
            </div>
          </div>
        </a>
      ))}
    </div>
  </div>
  <button type="button" class="util-button primary button" data-submit-form-search>
    <span>Показать все результаты</span>
  </button>
</div>
<div class="header-search-fake">
  <link rel="stylesheet" href="./components/header-search.css"/>
  <script src="./components/header-search.js" is:inline async></script>
</div>
